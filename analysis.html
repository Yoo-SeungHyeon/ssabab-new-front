<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 메뉴 분석</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #eaf2f8; /* 기본 배경색 */
            overflow-x: hidden; /* 가로 스크롤 방지 */
        }
        /* 노란색 계열 그라데이션 배경 */
        .section-gradient-yellow {
            background: linear-gradient(to bottom, #FFD700, #FFFFFF); /* 황금색에서 흰색으로 */
        }
        .text-shadow-lg {
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);
        }
        /* H1 태그를 위한 텍스트 그라데이션 및 그림자 스타일 */
        .h1-gradient-text {
            background: linear-gradient(to right, #FFD700, #FFA500); /* 황금색에서 주황색으로 */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent; /* Fallback for non-webkit browsers */
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.2)); /* 선명한 그림자 */
        }

        /* 탭 버튼 스타일 */
        .tab-button {
            background-color: #f3f4f6; /* Light gray */
            color: #4b5563; /* Darker gray text */
            border: 1px solid #d1d5db; /* Gray border */
            transition: all 0.2s ease;
        }
        .tab-button.selected {
            background-color: #f97316; /* Orange-500 */
            color: white;
            border-color: #f97316;
            box-shadow: 0 4px 6px rgba(249, 115, 22, 0.3); /* Orange shadow */
        }
        .tab-button:hover:not(.selected) {
            background-color: #e5e7eb; /* Lighter gray on hover */
        }

        /* 분석 카드 스타일 */
        .analysis-card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); /* shadow-lg */
            padding: 1.5rem; /* p-6 */
            border: 1px solid #e5e7eb; /* border-gray-200 */
        }

        /* 그래프 바 스타일 */
        .graph-bar-container {
            width: 100%;
            background-color: #e5e7eb; /* Light gray background for the bar track */
            border-radius: 9999px; /* rounded-full */
            height: 1.25rem; /* h-5 */
            overflow: hidden;
        }
        .graph-bar {
            height: 100%;
            border-radius: 9999px; /* rounded-full */
            transition: width 0.5s ease-in-out;
        }
        .bar-orange { background-color: #f97316; /* Orange-500 */ }
        .bar-yellow { background-color: #fbbf24; /* Yellow-400 */ }
        .bar-blue { background-color: #3b82f6; /* Blue-500 */ }
        .bar-green { background-color: #10b981; /* Green-600 */ }
    </style>
</head>
<body>

    <!-- Custom Message Box -->
    <div id="messageBoxOverlay" class="message-box-overlay">
        <div class="message-box-content">
            <p id="messageBoxText"></p>
            <!-- '확인' 버튼 제거됨 -->
        </div>
    </div>

    <!-- Header Section -->
    <header class="bg-white shadow-md py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-gray-800 rounded-lg">SSABAB</div>
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="main.html" class="text-gray-600 hover:text-blue-600 font-medium rounded-lg">홈</a></li>
                    <li><a href="review.html" class="text-gray-600 hover:text-blue-600 font-medium rounded-lg">평가하기</a></li>
                    <li><a href="analysis.html" class="text-blue-600 font-bold rounded-lg">분석보기</a></li>
                    <li><a href="mypage.html" class="text-gray-600 hover:text-blue-600 font-medium rounded-lg">마이페이지</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content: Analysis Page -->
    <div id="analysisPageContent" class="py-16 md:py-24 px-4 section-gradient-yellow">
        <div class="container mx-auto max-w-4xl bg-white rounded-xl shadow-2xl p-6 md:p-10 border border-gray-200">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4 text-gray-800 text-center leading-tight">
                <span class="block h1-gradient-text">분석보기</span>
            </h1>
            <p class="text-xl text-gray-600 text-center mb-10">오늘의 메뉴 데이터를 분석하여 유용한 정보를 얻으세요.</p>

            <!-- Tab Buttons for Monthly and Personal Analysis -->
            <div class="flex justify-center mb-10 space-x-4">
                <button type="button" id="monthlyAnalysisBtn" class="tab-button selected py-3 px-8 rounded-full text-lg font-semibold shadow-md transition-all duration-300 transform hover:scale-105 active:scale-95">
                    월간 분석
                </button>
                <button type="button" id="personalAnalysisBtn" class="tab-button py-3 px-8 rounded-full text-lg font-semibold shadow-md transition-all duration-300 transform hover:scale-105 active:scale-95">
                    개인 분석
                </button>
            </div>

            <!-- Analysis Content Area -->
            <div id="analysisContent">
                <!-- Content will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white py-8 rounded-t-lg mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 오늘의 메뉴. 모든 권리 보유.</p>
            <div class="flex justify-center space-x-6 mt-4">
                <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200 rounded-lg">개인정보처리방침</a>
                <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200 rounded-lg">이용약관</a>
                <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200 rounded-lg">문의</a>
            </div>
        </div>
    </footer>

    <script>
        // Custom Message Box elements
        const messageBoxOverlay = document.getElementById('messageBoxOverlay');
        const messageBoxText = document.getElementById('messageBoxText');
        // const messageBoxOkButton = document.getElementById('messageBoxOkButton'); // '확인' 버튼 제거됨

        /**
         * Function to display a custom message box
         * @param {string} message - Message to display
         * @param {function} onOkCallback - Callback function to execute on OK button click (optional)
         */
        function showMessage(message, onOkCallback = null) {
            messageBoxText.textContent = message;
            messageBoxOverlay.classList.add('visible');
            document.body.style.overflow = 'hidden'; // Prevent body scroll

            // 메시지 박스 오버레이 클릭 시 숨기기 (버튼 제거로 인한 대체)
            messageBoxOverlay.onclick = () => {
                hideMessage();
                if (onOkCallback) {
                    onOkCallback();
                }
            };
        }

        /**
         * Function to hide the custom message box
         */
        function hideMessage() {
            messageBoxOverlay.classList.remove('visible');
            document.body.style.overflow = 'auto'; // Allow body scroll
            messageBoxOverlay.onclick = null; // 이벤트 리스너 제거
        }

        // Analysis Data (Dummy Data for demonstration)
        const monthlyAnalysisData = {
            "topFoods": [
                { "name": "음식_7", "reviews": 1, "rating": 4 },
                { "name": "음식_6", "reviews": 1, "rating": 4 },
                { "name": "음식_9", "reviews": 1, "rating": 4 },
                { "name": "음식_5", "reviews": 1, "rating": 4 },
                { "name": "음식_1", "reviews": 1, "rating": 4 }
            ],
            "worstFoods": [
                { "name": "음식_8", "reviews": 1, "rating": 3 },
                { "name": "음식_2", "reviews": 1, "rating": 3 },
                { "name": "음식_7", "reviews": 1, "rating": 4 },
                { "name": "음식_6", "reviews": 1, "rating": 4 },
                { "name": "음식_9", "reviews": 1, "rating": 4 }
            ],
            "monthlyVisitors": {
                "current": 120,
                "previous": 100,
                "totalCumulative": 500,
                "previousMonthCumulative": 400
            },
            "cumulativeEvaluations": {
                "currentMonth": 80,
                "totalCumulative": 350,
                "previousMonthCumulative": 270
            },
            "ratingDistribution": {
                "min": 3,
                "max": 4,
                "avg": 3.83,
                "iqrStart": 4,
                "iqrEnd": 4,
                "variance": 0.15,
                "stdDev": 0.39
            },
            "frequentVisitors": [
                { "name": "김형석v4", "visits": 12, "lastVisit": "2025.06.19" },
                { "name": "이철수", "visits": 10, "lastVisit": "2025.06.18" },
                { "name": "박영희", "visits": 8, "lastVisit": "2025.06.17" }
            ],
            "monthlyOverallRating": {
                "average": 3.83,
                "totalEvaluations": 80
            }
        };

        const personalAnalysisData = {
            "dm_user_summary": {
                "userId": 9,
                "avgScore": 3.1111112,
                "totalReviews": 18,
                "preVoteCount": 3
            },
            "dm_user_food_rating_rank_best": [
                { "userId": 9, "foodName": "단무지", "foodScore": 5.0, "rankOrder": 1, "scoreType": "best" },
                { "userId": 9, "foodName": "갈비찜", "foodScore": 5.0, "rankOrder": 2, "scoreType": "best" },
                { "userId": 9, "foodName": "떡국", "foodScore": 5.0, "rankOrder": 3, "scoreType": "best" },
                { "userId": 9, "foodName": "콩나물무침", "foodScore": 4.5, "rankOrder": 4, "scoreType": "best" },
                { "userId": 9, "foodName": "김치찌개", "foodScore": 4.5, "rankOrder": 5, "scoreType": "best" }
            ],
            "dm_user_food_rating_rank_worst": [
                { "userId": 9, "foodName": "육개장", "foodScore": 1.0, "rankOrder": 1, "scoreType": "worst" },
                { "userId": 9, "foodName": "미역국", "foodScore": 1.0, "rankOrder": 2, "scoreType": "worst" },
                { "userId": 9, "foodName": "깍두기", "foodScore": 1.5, "rankOrder": 3, "scoreType": "worst" },
                { "userId": 9, "foodName": "떡갈비", "foodScore": 2.0, "rankOrder": 4, "scoreType": "worst" },
                { "userId": 9, "foodName": "김치전", "foodScore": 2.0, "rankOrder": 5, "scoreType": "worst" }
            ],
            "dm_user_category_stats": [
                { "userId": 9, "category": "한식", "count": 16 },
                { "userId": 9, "category": "중식", "count": 2 }
            ],
            "dm_user_tag_stats": [
                { "userId": 9, "tag": "고기", "count": 4 },
                { "userId": 9, "tag": "국", "count": 3 },
                { "userId": 9, "tag": "면", "count": 2 },
                { "userId": 9, "tag": "야채", "count": 4 },
                { "userId": 9, "tag": "기타", "count": 5 }
            ],
            "dm_user_review_word": [
                { "userId": 9, "word": "별로", "count": 1 },
                { "userId": 9, "word": "맛있다", "count": 1 },
                { "userId": 9, "word": "우웩", "count": 1 },
                { "userId": 9, "word": "기대하다", "count": 1 },
                { "userId": 9, "word": "도리", "count": 1 }
            ],
            "dm_user_insight": {
                "userId": 9,
                "insight": "- 사용자의 특징을 반영하는 단어와 문구를 사용해 최대한 자연스러운 표현을 사용하세요."
            },
            "dm_user_group_comparison": {
                "userId": 9,
                "groupType": "all",
                "userAvgScore": 3.1111112,
                "userDiversityScore": 2.0,
                "groupAvgScore": 3.0370371,
                "groupDiversityScore": 3.0
            }
        };

        // DOM elements
        const analysisContentDiv = document.getElementById('analysisContent');
        const monthlyAnalysisBtn = document.getElementById('monthlyAnalysisBtn');
        const personalAnalysisBtn = document.getElementById('personalAnalysisBtn');

        /**
         * Renders the monthly analysis content.
         * @param {Object} data - Monthly analysis data.
         */
        function renderMonthlyAnalysis(data) {
            analysisContentDiv.innerHTML = `
                <div class="space-y-8">
                    <!-- 월간 통계 요약 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">월간 통계 요약</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                            <p><strong>이번 달 방문자:</strong> ${data.monthlyVisitors.current}명 (지난 달 ${data.monthlyVisitors.previous}명)</p>
                            <p><strong>총 누적 방문자:</strong> ${data.monthlyVisitors.totalCumulative}명</p>
                            <p><strong>이번 달 평가 수:</strong> ${data.cumulativeEvaluations.currentMonth}건</p>
                            <p><strong>총 누적 평가 수:</strong> ${data.cumulativeEvaluations.totalCumulative}건</p>
                            <p><strong>월간 평균 별점:</strong> ${data.monthlyOverallRating.average.toFixed(2)} / 5</p>
                        </div>
                    </div>

                    <!-- Top 5 음식 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">이번 달 TOP 5 음식</h2>
                        <div class="space-y-3">
                            ${data.topFoods.map(food => `
                                <div class="flex items-center">
                                    <span class="w-1/4 text-left font-medium">${food.name}</span>
                                    <div class="w-2/4 graph-bar-container">
                                        <div class="graph-bar bar-orange" style="width: ${(food.rating / 5) * 100}%"></div>
                                    </div>
                                    <span class="w-1/4 text-right text-sm font-semibold">${food.rating}점 (${food.reviews}개 리뷰)</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Worst 5 음식 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">이번 달 WORST 5 음식</h2>
                        <div class="space-y-3">
                            ${data.worstFoods.map(food => `
                                <div class="flex items-center">
                                    <span class="w-1/4 text-left font-medium">${food.name}</span>
                                    <div class="w-2/4 graph-bar-container">
                                        <div class="graph-bar bar-yellow" style="width: ${(food.rating / 5) * 100}%"></div>
                                    </div>
                                    <span class="w-1/4 text-right text-sm font-semibold">${food.rating}점 (${food.reviews}개 리뷰)</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- 자주 방문한 사용자 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">자주 방문한 사용자</h2>
                        <ul class="list-disc list-inside space-y-2 text-lg">
                            ${data.frequentVisitors.map(visitor => `
                                <li><strong>${visitor.name}</strong>: ${visitor.visits}회 방문 (마지막 방문: ${visitor.lastVisit})</li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        /**
         * Renders the personal analysis content.
         * @param {Object} data - Personal analysis data.
         */
        function renderPersonalAnalysis(data) {
            const userSummary = data.dm_user_summary;
            const bestFoods = data.dm_user_food_rating_rank_best;
            const worstFoods = data.dm_user_food_rating_rank_worst;
            const categoryStats = data.dm_user_category_stats;
            const tagStats = data.dm_user_tag_stats;
            const reviewWords = data.dm_user_review_word;
            const insight = data.dm_user_insight;
            const groupComparison = data.dm_user_group_comparison;

            // Calculate max count for category and tag stats for scaling bars
            const maxCategoryCount = Math.max(...categoryStats.map(stat => stat.count));
            const maxTagCount = Math.max(...tagStats.map(stat => stat.count));

            analysisContentDiv.innerHTML = `
                <div class="space-y-8">
                    <!-- 사용자 요약 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">내 리뷰 요약</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                            <p><strong>평균 점수:</strong> ${userSummary.avgScore.toFixed(2)} / 5</p>
                            <p><strong>총 리뷰 수:</strong> ${userSummary.totalReviews}건</p>
                            <p><strong>사전 투표 수:</strong> ${userSummary.preVoteCount}회</p>
                        </div>
                    </div>

                    <!-- 가장 좋아하는 음식 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">가장 좋아하는 음식 TOP 5</h2>
                        <div class="space-y-3">
                            ${bestFoods.map(food => `
                                <div class="flex items-center">
                                    <span class="w-1/4 text-left font-medium">${food.foodName}</span>
                                    <div class="w-2/4 graph-bar-container">
                                        <div class="graph-bar bar-blue" style="width: ${(food.foodScore / 5) * 100}%"></div>
                                    </div>
                                    <span class="w-1/4 text-right text-sm font-semibold">${food.foodScore.toFixed(1)}점</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- 가장 싫어하는 음식 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">가장 싫어하는 음식 WORST 5</h2>
                        <div class="space-y-3">
                            ${worstFoods.map(food => `
                                <div class="flex items-center">
                                    <span class="w-1/4 text-left font-medium">${food.foodName}</span>
                                    <div class="w-2/4 graph-bar-container">
                                        <div class="graph-bar bar-green" style="width: ${(food.foodScore / 5) * 100}%"></div>
                                    </div>
                                    <span class="w-1/4 text-right text-sm font-semibold">${food.foodScore.toFixed(1)}점</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- 카테고리별 통계 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">카테고리별 리뷰 통계</h2>
                        <div class="space-y-3">
                            ${categoryStats.map(stat => `
                                <div class="flex items-center">
                                    <span class="w-1/4 text-left font-medium">${stat.category}</span>
                                    <div class="w-2/4 graph-bar-container">
                                        <div class="graph-bar bar-blue" style="width: ${(stat.count / maxCategoryCount) * 100}%"></div>
                                    </div>
                                    <span class="w-1/4 text-right text-sm font-semibold">${stat.count}회</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- 태그별 통계 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">태그별 리뷰 통계</h2>
                        <div class="space-y-3">
                            ${tagStats.map(stat => `
                                <div class="flex items-center">
                                    <span class="w-1/4 text-left font-medium">${stat.tag}</span>
                                    <div class="w-2/4 graph-bar-container">
                                        <div class="graph-bar bar-green" style="width: ${(stat.count / maxTagCount) * 100}%"></div>
                                    </div>
                                    <span class="w-1/4 text-right text-sm font-semibold">${stat.count}회</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- 자주 사용한 리뷰 단어 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">자주 사용한 리뷰 단어</h2>
                        <ul class="list-disc list-inside space-y-2 text-lg flex flex-wrap gap-x-4">
                            ${reviewWords.map(word => `
                                <li><strong>${word.word}</strong>: ${word.count}회</li>
                            `).join('')}
                        </ul>
                    </div>

                    <!-- 사용자 인사이트 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">나의 식습관 인사이트</h2>
                        <p class="text-lg">${insight.insight}</p>
                    </div>

                    <!-- 그룹 비교 -->
                    <div class="analysis-card">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">전체 사용자 그룹 비교</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                            <p><strong>내 평균 점수:</strong> ${groupComparison.userAvgScore.toFixed(2)}</p>
                            <p><strong>전체 그룹 평균 점수:</strong> ${groupComparison.groupAvgScore.toFixed(2)}</p>
                            <p><strong>내 다양성 점수:</strong> ${groupComparison.userDiversityScore.toFixed(1)}</p>
                            <p><strong>전체 그룹 다양성 점수:</strong> ${groupComparison.groupDiversityScore.toFixed(1)}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event Listeners for Tab Buttons
        monthlyAnalysisBtn.addEventListener('click', () => {
            monthlyAnalysisBtn.classList.add('selected');
            personalAnalysisBtn.classList.remove('selected');
            renderMonthlyAnalysis(monthlyAnalysisData);
        });

        personalAnalysisBtn.addEventListener('click', () => {
            personalAnalysisBtn.classList.add('selected');
            monthlyAnalysisBtn.classList.remove('selected');
            renderPersonalAnalysis(personalAnalysisData);
        });

        // Initial render on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Default to monthly analysis
            renderMonthlyAnalysis(monthlyAnalysisData);
        });
    </script>
</body>
</html>
